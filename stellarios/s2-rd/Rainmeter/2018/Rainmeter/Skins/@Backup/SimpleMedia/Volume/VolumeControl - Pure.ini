[Variables]
@Include=#@#Variables.ini
Background=0
Mute=0

[Rainmeter]
Update=1000
ContextTitle=Settings
ContextAction=["#@#Variables.ini"]
Dragmargins=((#BarScale#*220)-(#BarScale#*200))/2),20,(((#BarScale#*220)-(#BarScale#*200))/2),0

----- Calculations -----

[Calclimit]
Measure=Calc
Formula=([VolumeButton:x]+[MeterVolumeBar:w]*#VolumeIncrement#/100)>((#BarScale#*220)-((#BarScale#*220)-(#BarScale#*200)))/2-[VolumeButton:W]/2)?((#BarScale#*220)-((#BarScale#*220)-(#BarScale#*200)))/2-[VolumeButton:W]/2):([VolumeButton:x]+[MeterVolumeBar:w]*#VolumeIncrement#/100)
DynamicVariables=1

[CalcPlimit]
Measure=Calc
Formula=([VolumeButton:x]-[MeterVolumeBar:w]*#VolumeIncrement#/100)<0?0:([VolumeButton:x]-[MeterVolumeBar:w]*#VolumeIncrement#/100)
DynamicVariables=1

----- Measures -----

[MeasureWin7Audio]
Measure=Plugin
Plugin=Win7AudioPlugin
IfBelowValue=0
IfAboveValue=-1

[MeasureVolume]
Measure=Calc
Formula=
DynamicVariables=1

----- Meters -----

[VolumeBar]
Meter=Bar
MeasureName=MeasureWin7Audio
X=(#BarScale#*25)
Y=(#BarScale#*5)
W=(#BarScale#*230)
H=(#BarScale#*10)
BarColor=#Color#
SolidColor=#Color#,100
BarOrientation=Horizontal

[BackgroundInvis]
Meter=Shape
Shape=Rectangle 0,0,(#BarScale#*260),(#BarScale#*20),3,3 | StrokeWidth 0 | FillColor #Color#,1
MouseScrollDownAction=[!CommandMeasure "MeasureWin7Audio" "ChangeVolume -#VolumeIncrement#"][!update][!SetOption "VolumeButtonAlphaN" "x" "([CalcPlimit]-5)"][!SetOption "VolumeButtonAlphaP" "x" "([CalcPlimit]+20)"][!SetOption "VolumeButton" "x" "[CalcPlimit]"][!Update]
MouseScrollUpAction=[!CommandMeasure "MeasureWin7Audio" "ChangeVolume +#VolumeIncrement#"][!update][!SetOption "VolumeButtonAlphaN" "x" "([Calclimit]-5)"][!SetOption "VolumeButtonAlphaP" "x" "([Calclimit]+20)"][!SetOption "VolumeButton" "x" "[Calclimit]"][!Update]
LeftMouseUpAction=[!WriteKeyValue Variables Background 1][!Refresh]
UpdateDivider=-1

[Background]
Meter=Shape
Shape=Rectangle 0,0,(#BarScale#*260),(#BarScale#*20),3,3 | StrokeWidth 0 | FillColor #Color#,75
MouseScrollDownAction=[!CommandMeasure "MeasureWin7Audio" "ChangeVolume -#VolumeIncrement#"][!update][!SetOption "VolumeButtonAlphaN" "x" "([CalcPlimit]-5)"][!SetOption "VolumeButtonAlphaP" "x" "([CalcPlimit]+20)"][!SetOption "VolumeButton" "x" "[CalcPlimit]"][!Update]
MouseScrollUpAction=[!CommandMeasure "MeasureWin7Audio" "ChangeVolume +#VolumeIncrement#"][!update][!SetOption "VolumeButtonAlphaN" "x" "([Calclimit]-5)"][!SetOption "VolumeButtonAlphaP" "x" "([Calclimit]+20)"][!SetOption "VolumeButton" "x" "[Calclimit]"][!Update]
LeftMouseUpAction=[!WriteKeyValue Variables Background 0][!Refresh]
UpdateDivider=-1

[MuteOff]
Meter=Shape
Shape=Ellipse (#BarScale#*12.5),(#BarScale#*10),(#BarScale#*6),(#BarScale#*6) | StrokeWidth 2 | StrokeColor #Color# | FillColor 255,255,255,1
LeftMouseUpAction=[!CommandMeasure "MeasureWin7Audio" "ToggleMute"][!WriteKeyValue Variables Mute 1][!Refresh]
RightMouseUpAction=["sndvol.exe"]
UpdateDivider=-1

[MuteOn]
Meter=Shape
Shape=Ellipse (#BarScale#*12.5),(#BarScale#*10),(#BarScale#*6),(#BarScale#*6) | StrokeWidth 2 | StrokeColor #Color# | FillColor #Color#
LeftMouseUpAction=[!CommandMeasure "MeasureWin7Audio" "ToggleMute"][!WriteKeyValue Variables Mute 0][!Refresh]
RightMouseUpAction=["sndvol.exe"]
UpdateDivider=-1
Hidden=1

[BackgroundCalc]
Measure=Calc
Formula=#Background#
IfCondition=BackgroundCalc = 1
IfTrueAction=[!ShowMeter Background]
IfCondition2=BackgroundCalc = 0
IfTrueAction2=[!HideMeter Background]

[MuteCalc]
Measure=Calc
Formula=#Mute#
IfCondition=MuteCalc = 1
IfTrueAction=[!ShowMeter MuteOn]
IfFalseAction=[!HideMeter MuteOn]
